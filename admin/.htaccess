# Admin Panel Security
# Защита админ-панели от несанкционированного доступа

# Запретить доступ к файлам конфигурации
<Files "*.js">
    Order Allow,Deny
    Deny from all
</Files>

# Разрешить только HTML файлы
<Files "*.html">
    Order Allow,Deny
    Allow from all
</Files>

# Защита от прямого доступа к конфигурационным файлам
<Files "app-config.js">
    Order Allow,Deny
    Deny from all
</Files>

# Защита от сканирования директорий
Options -Indexes

# Защита от hotlinking
RewriteEngine On
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?yourdomain.com [NC]
RewriteRule \.(jpg|jpeg|png|gif|css|js)$ - [NC,F,L]

# Защита от SQL инъекций (если используется)
RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING} ^.*(\[|\]|\(|\)|<|>|ê|"|;|\?|\*|=$).* [NC,OR]
RewriteCond %{QUERY_STRING} (NULL|OUTFILE|LOAD_FILE) [OR]
RewriteCond %{QUERY_STRING} (\./|\../|\.../)+(motd|etc|bin) [NC,OR]
RewriteCond %{QUERY_STRING} (localhost|loopback|127\.0\.0\.1) [NC,OR]
RewriteCond %{QUERY_STRING} (<|>|'|%0A|%0D|%27|%3C|%3E|%00) [NC,OR]
RewriteCond %{QUERY_STRING} concat[^\(]*\( [NC,OR]
RewriteCond %{QUERY_STRING} (union|select|insert|drop|delete|update|cast|create|char|convert|alter|declare|exec|script|set|md5|benchmark|encode) [NC]
RewriteRule ^(.*)$ - [F,L]

# Защита от XSS атак
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://www.gstatic.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://api.ipify.org;"
</IfModule>

# Ограничение доступа по IP (раскомментируйте и добавьте ваши IP)
# <RequireAll>
#     Require ip 192.168.1.0/24
#     Require ip 10.0.0.0/8
# </RequireAll>

# Защита от ботов
RewriteCond %{HTTP_USER_AGENT} (bot|crawler|spider|scraper) [NC]
RewriteRule ^(.*)$ - [F,L]

# Ограничение размера загружаемых файлов
LimitRequestBody 10485760  # 10MB

# Защита от перечисления файлов
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>
